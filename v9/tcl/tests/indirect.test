# V9 indirect view tests for the V9x C extension
# 2009-05-08 <jcw@equi4.com> http://opensource.org/licenses/mit-license.php
# $Id$
# %renumber<^\s*test indirect->%

source [file join [file dirname [info script]] setup.tcl]

test indirect-0 {load and check V9x package} { package require V9x } $version

set V [v9 def A,B,C 1 2 3 4 5 6 7 8 9]

test indirect-1 {try step view via raw handler} {
    v9 dump {step 5 4 3 2}
} { \
  ? 
  --
   4
   4
   7
   7
  10}

test indirect-2 {iota operator} {
    v9 get [v9 iota 3]
} {0 1 2}

test indirect-3 {more step views via raw handler} {
    list [v9 get {step 9 0 2 1}] [v9 get {step 3 5 -1 1}]
} {{0 2 4 6 8 10 12 14 16} {5 4 3}}

test indirect-4 {rowmap operator via raw handlers} {
    v9 get {rowmap {step 9 0 2 1} {step 3 5 -1 1}}
} {10 8 6}

test indirect-5 {first operator} {
    v9 get [v9 first {step 9 0 2 1} 3]
} {0 2 4}

test indirect-6 {colmap operator} {
    v9 get [list colmap $V {step 1 1 1 1}]
} {2 5 8}

test indirect-7 {colmap operator} {
    v9 dump [list colmap $V [v9 ivec 0 2 2 1]]
} { \
  A  C  C  B
  -  -  -  -
  1  3  3  2
  4  6  6  5
  7  9  9  8}

test indirect-8 {plus operator} {
    v9 get [list plus [v9 iota 3] [v9 iota 5]]
} {0 1 2 0 1 2 3 4}

test indirect-9 {pair operator} {
    v9 dump [list pair [v9 iota 3] [v9 iota 5]]
} { \
  ?  ?
  -  -
  0  0
  1  1
  2  2}

test indirect-10 {times operator} {
    v9 get [list times [v9 iota 3] 2]
} {0 1 2 0 1 2}

test indirect-11 {spread operator} {
    v9 get [v9 spread [v9 iota 3] 2]
} {0 0 1 1 2 2}

test indirect-12 {product operator} {
    v9 dump [v9 product $V [v9 iota 2]]
} { \
  A  B  C  ?
  -  -  -  -
  1  2  3  0
  1  2  3  1
  4  5  6  0
  4  5  6  1
  7  8  9  0
  7  8  9  1}

test indirect-13 {tag operator} {
    v9 dump [v9 tag $V]
} { \
  A  B  C  ?
  -  -  -  -
  1  2  3  0
  4  5  6  1
  7  8  9  2}

cleanup V
