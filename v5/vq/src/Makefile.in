ifeq ($(ARCHSUFFIX),)
	dll = .so
	dyn = -shared
	CFLAGS += -fPIC
endif
ifeq ($(ARCHSUFFIX),.macosx)
	dll = .dylib
	dyn = -dynamiclib -fno-common
endif

CFLAGS += -Wall -pedantic -Wstrict-prototypes -Wno-unknown-pragmas
CFLAGS += -I../src -ansi
CFLAGS_REL = $(CFLAGS) -O3
CFLAGS += -DDEBUG -g -O0

TARGET = libvq5$(dll)

SRC = ../src/vqtcl.c ../src/vq4c.h ../src/vqdefs.h \
	../src/vqcore.c ../src/vqwrap.c ../src/vqmem.c ../src/vqnew.c
		
all: $(TARGET)

$(TARGET): $(SRC)
	@echo Compiling $(TARGET)
	@$(CC) $(CFLAGS) $(dyn) -o $(TARGET) ../src/vqtcl.c
	@echo OK

release: $(SRC)
	@echo Compiling $(TARGET) - RELEASE
	@$(CC) $(CFLAGS_REL) $(dyn) -o $(TARGET) ../src/vqtcl.c
	@echo OK
	strip -x $(TARGET)

test: $(TARGET)
	../tests/all.tcl

clean:
	rm -f *.o $(TARGET)

distclean: clean
	rm -f Makefile pkgIndex.tcl
