ifeq ($(ARCHSUFFIX),)
	dll = .so
	dyn = -shared
	# find Tcl headers on Ubuntu Linux:
	CFLAGS += -I/usr/include/tcl8.4
	CFLAGS += -fPIC
endif
ifeq ($(ARCHSUFFIX),.macosx)
	dll = .dylib
	dyn = -dynamiclib -fno-common
	CFLAGS += -isysroot /Developer/SDKs/MacOSX10.4u.sdk
endif

CFLAGS += -Wall -pedantic -Wstrict-prototypes -Wno-unknown-pragmas
CFLAGS += -I../src -ansi
CFLAGS_REL = $(CFLAGS) -O3
CFLAGS += -DDEBUG -g -O0

TARGET = libvq5$(dll)

HDR = ../src/vqtcl.c ../src/vq4c.h ../src/defs.h ../src/core.c
SRC = ../src/reader.c ../src/vqtcl.c
		
all: $(TARGET)

$(TARGET): $(HDR) $(SRC)
	@echo Compiling $(TARGET)
	@$(CC) $(CFLAGS) $(dyn) -o $(TARGET) $(SRC)
	@echo OK

release: $(HDR) $(SRC)
	@echo Compiling $(TARGET) - RELEASE
	@$(CC) $(CFLAGS_REL) $(dyn) -o $(TARGET) $(SRC)
	@echo OK
	strip -x $(TARGET)

test: $(TARGET)
	../tests/all.tcl

clean:
	rm -f *.o $(TARGET)

distclean: clean
	rm -f Makefile pkgIndex.tcl
