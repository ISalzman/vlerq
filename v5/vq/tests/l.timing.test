#!/usr/bin/env tclkit
# timing tests
# %renumber<^\s*test >%

source [file join [file dir [info script]] initests.tcl]

test 0 {load package} {
    package require vq
} $version

test 1 {set array entry} {
    array set a {0 a 1 b 2 c 3 d 4 e}
    set t [time { set a(2) 9 } 10000]
    puts [format "1 %10.3f uS" [lindex $t 0]]
    lsort [array get a]
} {0 1 2 3 4 9 a b d e}

unset a

test 2 {set list entry} {
    set a {0 1 2 3 4}
    set t [time { lset a 2 9 } 10000]
    puts [format "2 %10.3f uS" [lindex $t 0]]
    set a
} {0 1 9 3 4}

test 3 {set table entry} {
    set a [vq iota 5 N]
    set t [time { vq set @a 2 0 9 } 10000]
    puts [format "3 %10.3f uS" [lindex $t 0]]
    set a
} {data {mdef N:I} 5 {0 1 9 3 4}}

test 4 {more ranges} -constraints slow -body {
    set a [vq iota 10000 N]
    for {set x 9999} {$x >= 0} {incr x -1} {
        vq replace @a $x 0 3
    }
    set t [time { vq set @a 39998 0 -1 } 10000]
    puts [format "4 %10.3f uS" [lindex $t 0]]
    set a
} -match glob -result \
    {data {mdef N:I} 40000 {0 1 2 * 9997 9998 -1 9999}\
                           {0 3 4 7 * 39992 39995 39996 39998}}

test 5 {access to ranges} knownbug {
    set r {}
    foreach x {0 1 2 3 4 39995 39996 39997 39998 39999} {
        lappend r [vq at $a $x 0 -9]
    }
    set r
} {-9 -9 -9 0 -9 9998 -9 -9 -1 9999}

::tcltest::cleanupTests
