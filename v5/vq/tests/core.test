#!/usr/bin/env tclkit
# %renumber<^\s*test >%

# simple core tests

source [file join [file dir [info script]] initests.tcl]

test 0 {load package} {
    package require vq
} $version

test 1 {vq command} {
    catch { vq ? } e
    string match {bad command "?": must be *} $e
} 1

test 2 {missing argument} {
    catch { vq size } e
    set e
} {wrong # args: should be "vq size table"}

test 3 {} { vq size ""               } 0
test 4 {} { vq size 123              } 123
test 5 {} { vq size [vq meta ""]     } 3
test 6 {} { vq size {meta ""}        } 3
test 7 {} { vq at [vq meta ""] 0 0 ? } name
test 8 {} { vq at {meta ""} 1 0 ?    } type
test 9 {} { vq new ""                } 0

test 10 {} {
    vq config
} {5.0 load mutable nullable save}

test 11 {} { 
    vq iota 7 N 
} {data {mdef N:I} 7 {0 1 2 3 4 5 6}}

test 12 {} {
    vq size {iota 7 N}
} 7

test 13 {} {
    vq size {meta {iota 7 N}}
} 1

test 14 {} {
    set m [vq mdef {A:S B:L {C D:D} E:F}]
} {mdef {A B:L {C D:D} E:F}}

test 15 {} {
    vq size {mdef {A B {C D} E}}
} 4

test 16 {} {
    list [vq size $m] [vq at $m 0 0 ?] [vq at $m 1 1 0] [vq at $m 2 2 ""]
} {4 A 2 {mdef D:D}}

test 17 {} {
    vq size [vq data [vq mdef A] 3 {x y z}]
} 3

test 18 {} {
    vq size {data {mdef A} 3 {x y z}}
} 3

test 19 {} {
    vdump 7
} {  (7 rows, no columns)}

test 20 {} {
    vdump ""
} { \
  name  type  subt
  ----  ----  ----}

test 21 {} {
    vdump [vq meta ""]
} { \
  name  type  subt
  ----  ----  ----
  name     5    #0
  type     1    #0
  subt     7    #0}

test 22 {} {
    vdump [vq iota 3 ABC]
} { \
  ABC
  ---
    0
    1
    2}

::tcltest::cleanupTests
