#!/usr/bin/env tclkit
# vinfo command tests

source [file join [file dir [info script]] initests.tcl]

# %renumber<^\s*test >%

test 0 {load extension} {
  package require ratcl
} 3

interp alias {} vinfo {} vlerq::vinfo
  
test 1 {vinfo exists} -body {
  vinfo
} -returnCodes error -result {wrong # args: should be "vlerq::vinfo ?fmt? obj"}

test 2 {} {
  vinfo ""
} {bytes 0 type {} refs 2}

test 3 {} {
  vinfo [list ""]
} {bytes -1 type list refs 2}
  
test 4 {} {
  set v [view A vdef {A B C}]
  vinfo $v
} {bytes -1 type list refs 3}

test 5 {} {
  set w <$v>
  list $v [vinfo "" $v]
} {{vdef A {A B C}} {bytes 14 type list refs 4}}

test 6 {} {
  list [catch { vinfo ? ? } e] $e
} {1 {error in format: ?}}

test 7 {} {
  vinfo f $v
} {bytes 14 type list refs 3 sizer std_sizer}

test 8 {} {
  vinfo * $v
} {bytes 14 type view refs 3 vsize 3 sizer std_sizer}

rename vinfo ""

test 9 {} {
  vlerq::vinfo ?
} {bytes 1 type {} refs 1}

test 10 {} {
  set v [view {A B} vdef {1 2 11 22}]
  lindex [view $v vorig] 0
} vdef

test 11 {} {
  lindex [view $v group A G | vorig] 0
} group

test 12 {} {
  lindex [view $v group A G | get 0 G | vorig] 0
} at

::tcltest::cleanupTests
