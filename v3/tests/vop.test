#!/usr/bin/env tclkit
# virtual operator tests

source [file join [file dir [info script]] initests.tcl]

# %renumber<^\s*test >%

test 0 {load extension} {
  package require ratcl
} 3

test 1 {view exists} -body {
  view
} -returnCodes error -result {wrong # args: should be "view v ... | ..."}

set R [view {A B C} vdef {a b c d a f c b d}]

test 2 {rename} {
  set v [view $R rename B X]
  list [view $v names] [view $v structure] [vget $v]
} {{A X C} SSS {a b c d a f c b d}}

test 3 {rename} {
  set v [view $R rename B X -1 Y]
  list [view $v names] [view $v structure] [vget $v]
} {{A X Y} SSS {a b c d a f c b d}}

set T [view {A B C D} vdef {a b c d a b e f b c e f e d c d e d e f a b d e}]

test 4 {ungroup} {
  set v [view $T group A B G | ungroup G]
  list [view $v names] [view $v structure] [view $v get]
} {{A B C D} SSSS {a b c d a b e f a b d e b c e f e d c d e d e f}}

test 5 {ungroup} {
  view $T group A B G | collect { [vget $(G) #] }
} {3 1 2}

test 6 {ungroup} {
  foreach {v w} [view $T group A B G | get * G | vflat 1] break
  list [view $v names] [view $v structure] [view $v get] $w
} {{C D} SS {c d e f d e e f c d e f} {0 -1 -2 1 2 -1}}

::tcltest::cleanupTests
