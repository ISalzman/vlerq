#!/usr/bin/tclsh
# z27tcl.test -=- test suite for the tcl scanner code
# %renumber<^test >%

set uses {thrill}
source [file join [file dirname [info script]] initests.tcl]
thrill::vsetup

test 0 {thrive vm has been set up} {
  regexp {^::thrive_\d+$} $::thrill::v::ws
} 1

test 1 {basic parse} {
  thrill::vcall { xtcl exec } S {set a [c $d(1)]}
} {T {X {L set} {L a} {X {L c} {A d {L 1}}}}}

test 2 {another parse} {
  thrill::vcall { xtcl exec } S \
    {set a "b $c $d(e) [set f [$g h $i($j)]]"}
} {T {X {L set} {L a} {M {L {b }} {S c} {C 32} {A d {L e}} {C 32} {X {L set} {L f} {X {S g} {L h} {A i {S j}}}}}}}

test 3 {data stack is empty} {
  vfinish
} {}

cleanupTests

# vim: set ft=tcl :
