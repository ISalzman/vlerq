
<html>
<!-- generated with Tcl's xmlgen-1.4 xmlgen] -->

 <head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8"></meta>
  <title>Thrive 2.23</title>
  <style type="text/css"><!-- var {color:#44a} pre {background-color:#eef} -->
  </style>
 </head>
 <body>
  <h3>NAME</h3>
  <blockquote>
   <p><b>Thrive - Threaded Interpreter Virtual Machine</b></p>
  </blockquote>
  <h3>SYNOPSIS</h3>
  <blockquote>
   <p>
    <tt>package require <b>Tcl</b> 8.4</tt><br />
    <tt>package require <b>thrive</b> 2.23</tt><br />
   </p>
   <tt><b>::thrive</b></tt><br />
   <tt><var>workspace</var> <b>eval</b> <var>token</var></tt><br />
   <tt><var>workspace</var> <b>find</b> <var>token</var></tt><br />
   <tt><var>workspace</var> <b>load</b> <var>script</var></tt><br />
   <tt><var>workspace</var> <b>pop</b></tt><br />
   <tt><var>workspace</var> <b>push</b> <var>desc</var> ?<var>values...</var>?</tt><br />
   <tt><var>workspace</var> <b>run</b> ?<var>cref</var>?</tt><br />
   <tt><var>workspace</var> <b>type</b> <var>arg</var></tt><br />
  </blockquote>
  <h3>DESCRIPTION</h3>
  <blockquote>
   <p>The <b>thrive</b> package defines a <q>thrive</q> command in Tcl to create
  and manage a virtual machine for use by <b>Vlerq</b>.
  This package is not normally called directly from application code.
   </p>
   <dl>
    <dt>
     <tt><b>::thrive</b></tt>
    </dt>
    <dd>
     <p>Create a Tcl command object representing a new virtual machine <q>workspace</q>.
  When the command is later deleted, all memory used by that workspace will
  be released.
  The name of the new workspace is returned,
  it is of the form <q>::thrive_NUM</q>.
     </p>
    </dd>
    <dt>
     <tt><var>workspace</var> <b>eval</b> <var>token</var></tt>
    </dt>
    <dd>
     <p>Look up and prepare to evaluate a symbol in the workspace.
  Actual evaluation will take place when <b>run</b> is called.
  Return the symbol index, or -1 of not found.
     </p>
    </dd>
    <dt>
     <tt><var>workspace</var> <b>find</b> <var>token</var></tt>
    </dt>
    <dd>
     <p>Look up (but do not evaluate) a symbol in the workspace.
  Return the symbol as a reference, or throw an error if not found.
     </p>
    </dd>
    <dt>
     <tt><var>workspace</var> <b>load</b> <var>script</var></tt>
    </dt>
    <dd>
     <p>Parse a script into tokens and evaluate them.
  The syntax rules match those of <b>Thrill</b>, a Forth-like language which
  is used to portably implement Vlerq's functionality on top of Thrive.
  Throws an error if the script does any callbacks.
     </p>
    </dd>
    <dt>
     <tt><var>workspace</var> <b>pop</b></tt>
    </dt>
    <dd>
     <p>Pop one value off the data stack and return it as a Tcl data structure.
  Ints and strings are returned as is, nil is returned as the empty string,
  and vectors are returned as lists (recursively converting items in them).
  Views and other objects are returned as a <q>reference</q>, see below.
     </p>
     <p>Cells of the form (Wn,X) are special.
  If X is zero, then this is <q>nil</q> (usually returned as empty string).
  Else an error is thrown.
  If X is -1 then the error value is configurable (default -1),
  else the error is always the number X itself.
     </p>
    </dd>
    <dt>
     <tt><var>workspace</var> <b>push</b> <var>desc</var> ?<var>values...</var>?</tt>
    </dt>
    <dd>
     <p>Convert Tcl values to Thrive values with specified types and push them
  onto the data stack.  No return value.
     </p>
     <p>The <var>desc</var> argument describes the types of all input values.
  There is one item for each of the values to be pushed:
     </p>
     <p>
     <blockquote>
      <table cellspacing="0">
       <tr>
        <td valign="top" nowrap=""><b>I</b></td>
        <td>&nbsp;</td>
        <td>an integer
        </td>
       </tr>
       <tr>
        <td valign="top" nowrap=""><b>S</b></td>
        <td>&nbsp;</td>
        <td>a string
        </td>
       </tr>
       <tr>
        <td valign="top" nowrap=""><b>a</b></td>
        <td>&nbsp;</td>
        <td>an int or a string, depending on what <q><b>string is int -strict</b></q> says
        </td>
       </tr>
       <tr>
        <td valign="top" nowrap=""><b>V</b></td>
        <td>&nbsp;</td>
        <td>a view reference, see below
        </td>
       </tr>
       <tr>
        <td valign="top" nowrap=""><b>n</b></td>
        <td>&nbsp;</td>
        <td>nil, the argument passed in should be <q>0</q>
        </td>
       </tr>
       <tr>
        <td valign="top" nowrap=""><b>(...)</b></td>
        <td>&nbsp;</td>
        <td>arg list, the <q>...</q> is again a list of the types inside that list
        </td>
       </tr>
      </table>
     </blockquote>
     </p>
     <p>An empty <var>desc</var> defaults to <q>S</q>.
  When <var>desc</var> is exhausted, it is restarted from the first item.
     </p>
    </dd>
    <dt>
     <tt><var>workspace</var> <b>run</b> ?<var>cref</var>?</tt>
    </dt>
    <dd>
     <p>Pump the run loop, keep going until it returns with a result or requests
  a trampoline callback.
  The optional <var>cref</var> is a reference to code
  which will get pushed and called.  Return 0 if there is no more work,
  &gt; 0 to request a callback, or &lt; 0 to flag a return or error condition.
     </p>
    </dd>
    <dt>
     <tt><var>workspace</var> <b>type</b> <var>arg</var></tt>
    </dt>
    <dd>
     <p>Return the Thrive type (a small integer) of <var>arg</var>.
  Throws an error if <var>arg</var> is not a reference.
     </p>
    </dd>
   </dl>
  </blockquote>
  <h3>REFERENCES</h3>
  <blockquote>
   <p>References provide a mechanism to refer to opaque objects in a 
  workspace without copying its data out to Tcl.  
  References can be returned by <b>pop</b> and by <b>find</b>.
   </p>
   <p>The only use for references is as parameter value for <b>push</b> or <b>run</b>,
  as an efficient way to refer to objects managed by Thrive.
  An object in Thrive will not be garbage collected as long as a reference
  to it exists, as tracked via the Tcl_Obj <q>dual representation</q>.
   </p>
   <p>References cannot be stored on file, or used in other workspaces.
   </p>
  </blockquote>
  <h3>EXAMPLES</h3>
  <blockquote>
   <p>Create a Thrive workspace and do some data stack manipulations:
   </p>
   <pre width="81n">&nbsp; % package require thrive
  2.23
  % set ws [thrive::new&#93;
  ::thrive_1
  % $ws push I(SI) 123 {one 1 two 2 three 3}
  % $ws pop
  one 1 two 2 three 3
  % $ws pop
  123
  %</pre>
   <p>The <q>I(SI)</q> descriptor in <b>push</b> describes the type of the two following
  values: an integer and a list consisting of alternating strings and ints.
   </p>
   <p>Some bootstrap code needs to be loaded before normal processing is possible,
  here's a minimal version:
   </p>
   <pre width="81n">&nbsp; $ws load { 0 exit exec -1 syst [[ }</pre>
   <p>Perform some arithmetic, now that the bootstrap has been loaded:
   </p>
   <pre width="81n">&nbsp; % $ws push II 234 345
  % $ws eval +
  33
  % $ws run
  0
  % $ws pop
  579
  %</pre>
   <p>Lastly, cleanup and release all memory used by the workspace:
   </p>
   <pre width="81n">&nbsp; % rename $ws &#34;&#34;
  %</pre>
  </blockquote>
  <h3>WEBSITE</h3>
  <blockquote>
   <p>See <a href="http://www.vlerq.org/">http://www.vlerq.org/</a>.</p>
  </blockquote>
  <h3>KEYWORDS</h3>
  <blockquote>
   <p>thrive, thrill, vlerq, virtual machine, vm, tcl</p>
  </blockquote>
 </body>
</html>